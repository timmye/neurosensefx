{"version":3,"file":"CTraderLayerEmitter.js","sourceRoot":"","sources":["../../../../../src/core/utilities/emitters/CTraderLayerEmitter.ts"],"names":[],"mappings":"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","sourcesContent":["import { CTraderLayerEvent } from \"#events/CTraderLayerEvent\";\nimport { CTraderLayerEventListener } from \"#events/CTraderLayerEventListener\";\nimport { GenericObject } from \"#utilities/GenericObject\";\nimport { v1 } from \"uuid\";\n\nexport class CTraderLayerEmitter {\n    static readonly #ANY_TYPE_KEY: string = \"*\";\n    readonly #listeners: Map<string, Map<string, CTraderLayerEventListener>>;\n\n    public constructor () {\n        this.#listeners = new Map();\n    }\n\n    public addEventListener (type: string, listener: CTraderLayerEventListener): string {\n        let uuid: string;\n\n        do {\n            uuid = v1();\n        }\n        while (this.#uuidExists(uuid)); // This software deals with money, better to avoid even the most improbable events\n\n        const listenersOfType: Map<string, CTraderLayerEventListener> = this.#listeners.get(type) ?? new Map();\n\n        listenersOfType.set(uuid, listener);\n        this.#listeners.set(type, listenersOfType);\n\n        return uuid;\n    }\n\n    public removeEventListener (uuid: string): void {\n        for (const type of this.#listeners.keys()) {\n            const listenersOfType: Map<string, CTraderLayerEventListener> | undefined = this.#listeners.get(type);\n\n            if (listenersOfType?.has(uuid)) {\n                listenersOfType.delete(uuid);\n\n                break;\n            }\n        }\n    }\n\n    public on (type: string): Promise<CTraderLayerEvent>\n    public on (type: string, listener: CTraderLayerEventListener): string\n    public on (type: string, listener?: CTraderLayerEventListener): Promise<CTraderLayerEvent> | string {\n        if (!listener) {\n            return new Promise((resolve: any): void => {\n                const uuid: string = this.addEventListener(type, async (event: CTraderLayerEvent): Promise<void> => {\n                    this.removeEventListener(uuid);\n                    resolve(event);\n                });\n            });\n        }\n\n        return this.addEventListener(type, listener);\n    }\n\n    public notifyListeners (type: string, descriptor?: GenericObject): void {\n        const date: Date = new Date();\n        const event: CTraderLayerEvent = new CTraderLayerEvent({\n            type,\n            date,\n            descriptor,\n        });\n\n        if (type !== CTraderLayerEmitter.#ANY_TYPE_KEY) {\n            const listenersOfAny: Map<string, CTraderLayerEventListener> = this.#listeners.get(CTraderLayerEmitter.#ANY_TYPE_KEY) ?? new Map();\n\n            for (const listener of listenersOfAny.values()) {\n                listener(event);\n            }\n        }\n\n        const listenersOfType: Map<string, CTraderLayerEventListener> = this.#listeners.get(type) ?? new Map();\n\n        for (const listener of listenersOfType.values()) {\n            listener(event);\n        }\n    }\n\n    #uuidExists (uuid: string): boolean {\n        for (const key of this.#listeners.keys()) {\n            const listeners: Map<string, CTraderLayerEventListener> | undefined = this.#listeners.get(key);\n\n            if (listeners?.has(uuid)) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n}\n"]}