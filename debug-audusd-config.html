<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AUDUSD Configuration Extractor</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1f2937;
            color: #d1d5db;
            margin: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .section {
            background: #374151;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #4b5563;
        }
        .audusd-config {
            background: #065f46;
            border-color: #10b981;
        }
        .factory-defaults {
            background: #7c2d12;
            border-color: #dc2626;
        }
        .diff {
            background: #451a03;
            border-color: #f59e0b;
        }
        pre {
            background: #111827;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        .parameter {
            color: #60a5fa;
        }
        .value {
            color: #34d399;
        }
        .different {
            color: #fbbf24;
            font-weight: bold;
        }
        .same {
            color: #6b7280;
        }
        h1, h2, h3 {
            color: #f3f4f6;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #2563eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç AUDUSD Configuration Analysis</h1>
        <p>This utility extracts and analyzes AUDUSD's workspace configuration to identify what makes its text crisp.</p>
        
        <button onclick="extractAndAnalyze()">üöÄ Extract & Analyze AUDUSD Config</button>
        <button onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
        <button onclick="exportData()">üì§ Export Analysis</button>
        
        <div id="results"></div>
    </div>

    <script>
        // Import workspace storage utilities
        const STORAGE_KEYS = {
            WORKSPACE_LAYOUT: 'neurosensefx-workspace-layout',
            GLOBAL_CONFIG: 'neurosensefx-global-config',
            DISPLAY_SIZES: 'neurosensefx-display-sizes'
        };

        // Factory defaults from configDefaults.js
        const FACTORY_DEFAULTS = {
            priceFontSize: 40,
            priceFontWeight: '600',
            priceDisplayPositioning: 'canvasRelative',
            priceDisplayHorizontalPosition: 2,
            priceDisplayXOffset: 0,
            priceDisplayPadding: 4,
            bigFigureFontSizeRatio: 80,
            pipFontSizeRatio: 100,
            pipetteFontSizeRatio: 70,
            showPipetteDigit: true,
            priceUseStaticColor: false,
            priceStaticColor: '#d1d5db',
            priceUpColor: '#3b82f6',
            priceDownColor: '#ef4444',
            showPriceBackground: true,
            priceBackgroundColor: '#111827',
            priceBackgroundOpacity: 0.5,
            showPriceBoundingBox: false,
            priceBoxOutlineColor: '#4b5563',
            priceBoxOutlineOpacity: 1,
            containerSize: { width: 220, height: 160 },
            visualizationsContentWidth: 100,
            meterHeight: 75,
            adrAxisPosition: 75
        };

        function extractAndAnalyze() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="section"><h2>üîÑ Extracting data...</h2></div>';
            
            try {
                // Extract all localStorage data
                const workspaceLayout = JSON.parse(localStorage.getItem(STORAGE_KEYS.WORKSPACE_LAYOUT) || '{}');
                const globalConfig = JSON.parse(localStorage.getItem(STORAGE_KEYS.GLOBAL_CONFIG) || '{}');
                const displaySizes = JSON.parse(localStorage.getItem(STORAGE_KEYS.DISPLAY_SIZES) || '{}');
                
                // Find AUDUSD display
                const audusdDisplay = workspaceLayout.displays?.find(d => d.symbol === 'AUDUSD');
                
                let html = '';
                
                // Show raw data
                html += '<div class="section">';
                html += '<h2>üìä Raw localStorage Data</h2>';
                html += '<h3>Workspace Layout</h3>';
                html += `<pre>${JSON.stringify(workspaceLayout, null, 2)}</pre>`;
                html += '</div>';
                
                if (audusdDisplay) {
                    html += '<div class="section audusd-config">';
                    html += '<h2>üá¶üá∫üá∏ AUDUSD Display Configuration</h2>';
                    html += `<pre>${JSON.stringify(audusdDisplay, null, 2)}</pre>`;
                    html += '</div>';
                    
                    // Analyze configuration
                    html += analyzeConfig(audusdDisplay, globalConfig);
                } else {
                    html += '<div class="section diff">';
                    html += '<h2>‚ùå AUDUSD Not Found</h2>';
                    html += '<p>No AUDUSD display found in current workspace layout.</p>';
                    html += '<h3>Available Symbols:</h3>';
                    html += '<ul>';
                    workspaceLayout.displays?.forEach(d => {
                        html += `<li>${d.symbol} (ID: ${d.id})</li>`;
                    });
                    html += '</ul>';
                    html += '</div>';
                }
                
                results.innerHTML = html;
                
            } catch (error) {
                results.innerHTML = `<div class="section diff"><h2>‚ùå Error</h2><pre>${error.message}</pre></div>`;
            }
        }
        
        function analyzeConfig(audusdDisplay, globalConfig) {
            const audusdConfig = audusdDisplay.config || {};
            
            // Merge with global config for effective configuration
            const effectiveConfig = { ...FACTORY_DEFAULTS, ...globalConfig.userDefaults, ...audusdConfig };
            
            let html = '<div class="section">';
            html += '<h2>üî¨ Configuration Analysis</h2>';
            
            // Text rendering parameters analysis
            html += '<h3>üìù Text Rendering Parameters</h3>';
            html += '<table style="width: 100%; border-collapse: collapse;">';
            html += '<tr><th>Parameter</th><th>AUDUSD Value</th><th>Factory Default</th><th>Status</th></tr>';
            
            const textParams = [
                'priceFontSize', 'priceFontWeight', 'bigFigureFontSizeRatio', 
                'pipFontSizeRatio', 'pipetteFontSizeRatio', 'showPipetteDigit',
                'priceDisplayPositioning', 'priceDisplayHorizontalPosition', 
                'priceDisplayXOffset', 'priceDisplayPadding'
            ];
            
            textParams.forEach(param => {
                const audusdValue = effectiveConfig[param];
                const factoryValue = FACTORY_DEFAULTS[param];
                const isDifferent = JSON.stringify(audusdValue) !== JSON.stringify(factoryValue);
                const statusClass = isDifferent ? 'different' : 'same';
                const status = isDifferent ? 'üî¥ DIFFERENT' : '‚úÖ SAME';
                
                html += `<tr>`;
                html += `<td class="parameter">${param}</td>`;
                html += `<td class="value">${JSON.stringify(audusdValue)}</td>`;
                html += `<td class="value">${JSON.stringify(factoryValue)}</td>`;
                html += `<td class="${statusClass}">${status}</td>`;
                html += `</tr>`;
            });
            
            html += '</table>';
            
            // Display size analysis
            html += '<h3>üìê Display Size Parameters</h3>';
            html += '<table style="width: 100%; border-collapse: collapse;">';
            html += '<tr><th>Parameter</th><th>AUDUSD Value</th><th>Factory Default</th><th>Impact on Text</th></tr>';
            
            const sizeParams = [
                'containerSize', 'visualizationsContentWidth', 'meterHeight', 'adrAxisPosition'
            ];
            
            sizeParams.forEach(param => {
                const audusdValue = effectiveConfig[param];
                const factoryValue = FACTORY_DEFAULTS[param];
                const isDifferent = JSON.stringify(audusdValue) !== JSON.stringify(factoryValue);
                const statusClass = isDifferent ? 'different' : 'same';
                const impact = getTextImpact(param, audusdValue, factoryValue);
                
                html += `<tr>`;
                html += `<td class="parameter">${param}</td>`;
                html += `<td class="value">${JSON.stringify(audusdValue)}</td>`;
                html += `<td class="value">${JSON.stringify(factoryValue)}</td>`;
                html += `<td class="${statusClass}">${impact}</td>`;
                html += `</tr>`;
            });
            
            html += '</table>';
            
            // Key findings
            html += '<h3>üéØ Key Findings</h3>';
            const findings = generateFindings(effectiveConfig);
            findings.forEach(finding => {
                html += `<p><strong>${finding.title}:</strong> ${finding.description}</p>`;
            });
            
            html += '</div>';
            
            return html;
        }
        
        function getTextImpact(param, audusdValue, factoryValue) {
            if (JSON.stringify(audusdValue) === JSON.stringify(factoryValue)) {
                return '‚úÖ No impact';
            }
            
            switch (param) {
                case 'containerSize':
                    const widthDiff = audusdValue.width - factoryValue.width;
                    const heightDiff = audusdValue.height - factoryValue.height;
                    return `üî¥ Size changed: ${widthDiff > 0 ? '+' : ''}${widthDiff}px √ó ${heightDiff > 0 ? '+' : ''}${heightDiff}px - affects DPI scaling`;
                    
                case 'visualizationsContentWidth':
                    const widthPctDiff = audusdValue - factoryValue;
                    return `üî¥ Content width: ${widthPctDiff > 0 ? '+' : ''}${widthPctDiff}% - affects font scaling space`;
                    
                case 'meterHeight':
                    const heightPctDiff = audusdValue - factoryValue;
                    return `üî¥ Height: ${heightPctDiff > 0 ? '+' : ''}${heightPctDiff}% - affects vertical text space`;
                    
                case 'adrAxisPosition':
                    const posDiff = audusdValue - factoryValue;
                    return `üî¥ Position: ${posDiff > 0 ? '+' : ''}${posDiff}% - affects text positioning`;
                    
                default:
                    return 'üî¥ May affect text rendering';
            }
        }
        
        function generateFindings(config) {
            const findings = [];
            
            // Check for crisp text indicators
            if (config.priceFontSize > FACTORY_DEFAULTS.priceFontSize) {
                findings.push({
                    title: 'üîç Larger Font Size',
                    description: `AUDUSD uses ${config.priceFontSize}% vs factory ${FACTORY_DEFAULTS.priceFontSize}% - larger fonts appear clearer`
                });
            }
            
            if (config.containerSize.width > FACTORY_DEFAULTS.containerSize.width) {
                findings.push({
                    title: 'üìê Larger Display Width',
                    description: `AUDUSD uses ${config.containerSize.width}px vs factory ${FACTORY_DEFAULTS.containerSize.width}px - more pixels for text rendering`
                });
            }
            
            if (config.visualizationsContentWidth > FACTORY_DEFAULTS.visualizationsContentWidth) {
                findings.push({
                    title: 'üìè Wider Content Area',
                    description: `AUDUSD uses ${config.visualizationsContentWidth}% vs factory ${FACTORY_DEFAULTS.visualizationsContentWidth}% - more space for text`
                });
            }
            
            if (config.priceFontWeight !== FACTORY_DEFAULTS.priceFontWeight) {
                findings.push({
                    title: '‚úçÔ∏è Different Font Weight',
                    description: `AUDUSD uses '${config.priceFontWeight}' vs factory '${FACTORY_DEFAULTS.priceFontWeight}' - affects text crispness`
                });
            }
            
            const totalFontRatio = config.bigFigureFontSizeRatio + config.pipFontSizeRatio + config.pipetteFontSizeRatio;
            const factoryTotalRatio = FACTORY_DEFAULTS.bigFigureFontSizeRatio + FACTORY_DEFAULTS.pipFontSizeRatio + FACTORY_DEFAULTS.pipetteFontSizeRatio;
            
            if (totalFontRatio > factoryTotalRatio) {
                findings.push({
                    title: 'üìä Larger Font Ratios',
                    description: `AUDUSD total ratio ${totalFontRatio}% vs factory ${factoryTotalRatio}% - overall larger text rendering`
                });
            }
            
            if (findings.length === 0) {
                findings.push({
                    title: '‚ùì No Clear Differences',
                    description: 'AUDUSD configuration matches factory defaults - crispness may come from other factors'
                });
            }
            
            return findings;
        }
        
        function clearAllData() {
            if (confirm('‚ö†Ô∏è This will clear all NeuroSense FX workspace data. Continue?')) {
                localStorage.removeItem(STORAGE_KEYS.WORKSPACE_LAYOUT);
                localStorage.removeItem(STORAGE_KEYS.GLOBAL_CONFIG);
                localStorage.removeItem(STORAGE_KEYS.DISPLAY_SIZES);
                document.getElementById('results').innerHTML = '<div class="section diff"><h2>üóëÔ∏è Data Cleared</h2><p>All workspace data has been removed from localStorage.</p></div>';
            }
        }
        
        function exportData() {
            const data = {
                workspaceLayout: JSON.parse(localStorage.getItem(STORAGE_KEYS.WORKSPACE_LAYOUT) || '{}'),
                globalConfig: JSON.parse(localStorage.getItem(STORAGE_KEYS.GLOBAL_CONFIG) || '{}'),
                displaySizes: JSON.parse(localStorage.getItem(STORAGE_KEYS.DISPLAY_SIZES) || '{}'),
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `neurosensefx-config-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // Auto-extract on page load
        window.addEventListener('load', extractAndAnalyze);
    </script>
</body>
</html>
